<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Purchase Request Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./company_layout.css">
    <style>
        body {
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        /* Top navbar */
        .top-navbar {
            background-color: #051e34;
            color: white;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1050;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .top-navbar .brand {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: bold;
        }
        .top-navbar .icon-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;        }
        .top-navbar .icon-button:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .user-avatar {
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        /* Main content */
        .main-content {
            margin-left: 240px;
            margin-top: 48px; /* Space for the top navbar */
            padding: 20px;
            min-height: calc(100vh - 48px);
            background: #f8f9fa;
        }
        /* Form styles */
        .header-container {
            background-color: #0d6efd;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .form-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .required-field::after {
            content: "*";
            color: red;
            margin-left: 3px;
        }
        .hidden-field {
            display: none;
        }
        #success-alert, #error-alert {
            display: none;
            margin-top: 20px;
        }
        /* Responsive */
        @media (max-width: 991.98px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                top: 48px;
            }
            .main-content {
                margin-left: 0;
                padding: 20px 10px;
                margin-top: 48px;
            }        }
            
        .avatar-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #0d6efd;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }        
        /* Image upload highlight styles */
        .card.border-primary {
            border-width: 2px !important;
        }
        .card.border-primary .card-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%) !important;
        }
        #imagePreviewContainer .border {
            transition: all 0.3s ease;
        }
        #imagePreviewContainer .border:hover {
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.15);
            transform: translateY(-2px);
        }
        
        /* Carousel styles */
        .carousel-item img {
            max-height: 500px;
            max-width: 100%;
            object-fit: contain;
            cursor: pointer;
            transition: transform 0.3s ease;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .carousel-item img:hover {
            transform: scale(1.02);
        }
        .carousel-control-prev,
        .carousel-control-next {
            background-color: rgba(13, 110, 253, 0.7);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
            margin: 0 15px;
        }
        .carousel-control-prev:hover,
        .carousel-control-next:hover {
            background-color: rgba(13, 110, 253, 0.9);
            opacity: 1;
        }
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            width: 20px;
            height: 20px;
        }
        .carousel-indicators {
            position: relative;
            margin-top: 15px;
        }
        .carousel-indicators button {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin: 0 5px;
            background-color: #ccc;
            opacity: 0.6;
        }
        .carousel-indicators button.active {
            background-color: #0d6efd;
            opacity: 1;
        }
        
        /* File upload styles */
        .custom-file-upload {
            position: relative;
            border: 2px dashed #0d6efd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            background-color: rgba(13, 110, 253, 0.05);
        }
        .custom-file-upload:hover {
            background-color: rgba(13, 110, 253, 0.1);
        }
        .custom-file-upload input[type="file"] {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }
        .file-drop-message {
            font-size: 1.1rem;
            color: #0d6efd;
            font-weight: 500;
        }
        .file-upload-info {
            z-index: 1;
        }
        .selected-file-count {
            font-weight: 600;
        }
        .custom-file-upload.dragover {
            background-color: rgba(13, 110, 253, 0.15);
            border-color: #0b5ed7;
        }
    </style>
</head>
<body>
    <!-- Top Navbar -->
    <div class="top-navbar">
        <div class="brand">
            <i class="fas fa-cube me-2"></i> LTS MANAGER
        </div>
        <div class="d-flex align-items-center">
            <button class="icon-button me-2">
                <i class="fas fa-bell"></i>
            </button>
            <button class="icon-button me-3">
                <i class="fas fa-cog"></i>
            </button>
            <div class="user-avatar">
                TD
            </div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <ul class="nav flex-column">            
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-calendar-alt"></i> Quản lý ngày nghỉ
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-users"></i> Quản lý QT
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-tasks"></i> Quản lý dự án
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-clock"></i> Chấm công
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-chart-line"></i> Đánh giá định kỳ
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fas fa-graduation-cap"></i> Quản lý kỹ năng
                </a>
            </li> 
            <!-- Procurement Section -->
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="procurementDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-shopping-cart"></i> Procurement
                </a>
                <ul class="dropdown-menu" aria-labelledby="procurementDropdown">
                    <li><a class="dropdown-item" href="index.html">
                        <i class="fas fa-file-alt"></i> Request List
                    </a></li>
                    <li><a class="dropdown-item" href="purchase_list.html">
                        <i class="fas fa-shopping-bag"></i> Purchase List
                    </a></li>
                    <li><a class="dropdown-item" href="supplier_select.html">
                        <i class="fas fa-users"></i> Suppliers Select</a></li>
                    <li><a class="dropdown-item" href="it_review_list.html">
                        <i class="fas fa-laptop"></i> IT Review Queue</a></li>
                    <li><a class="dropdown-item" href="dl_payment_confirmation_list.html">
                        <i class="fas fa-truck"></i> DL Confirm Payment</a></li>
                    <li><a class="dropdown-item" href="accountant_document_review.html">                        <i class="fas fa-list"></i> Document Review</a></li>
                    <li><a class="dropdown-item" href="advance_payment_approval_page.html">
                        <i class="fas fa-receipt"></i> Advance Payment Approval</a></li>
                    <li><a class="dropdown-item" href="accountant_reimbursement_approval.html">
                        <i class="fas fa-calculator"></i> Reimbursement Processing</a></li>
                    <li><a class="dropdown-item" href="supplier_management.html">
                        <i class="fas fa-building"></i> Supplier Management</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header-container">
            <h1>Purchase Request Form</h1>
            <p class="mb-0">Complete the form below to submit a new purchase request</p>
        </div>
        <div class="form-container">
            <form id="purchaseRequestForm">
                <!-- Audit Trail Fields (Hidden) -->
                <input type="hidden" id="creationDate" name="creationDate">
                <input type="hidden" id="submissionDate" name="submissionDate">
                <input type="hidden" id="requestStatus" name="requestStatus" value="Draft">
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label for="requestTitle" class="form-label required-field">Request Title</label>
                        <input type="text" class="form-control" id="requestTitle" name="requestTitle" placeholder="System auto fill" required>
                        <div class="invalid-feedback">Please enter a request title</div>
                    </div>
                    <div class="col-md-6">
                        <label for="requesterName" class="form-label">Requester Name</label>
                        <input type="text" class="form-control" id="requesterName" name="requesterName" readonly>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label for="department" class="form-label required-field">Department</label>
                        <select class="form-select" id="department" name="department" placeholder="System auto fill" required>
                            <option value="">Select Department</option>
                            <option value="IT">Information Technology</option>
                            <option value="HR">Human Resources</option>
                            <option value="Finance">Finance</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Operations">Operations</option>
                            <option value="Research">Research & Development</option>
                            <option value="Legal">Legal</option>
                            <option value="Sales">Sales</option>
                        </select>
                        <div class="invalid-feedback">Please select a department</div>
                    </div>
                    <div class="col-md-6">
                        <label for="dateRequested" class="form-label">Date Requested</label>
                        <input type="text" class="form-control date-picker" id="dateRequested" name="dateRequested">
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-12">
                        <label for="productCategory" class="form-label required-field">Product Category</label>
                        <select class="form-select" id="productCategory" name="productCategory" required>
                            <option value="">Select Category</option>
                            <option value="ITEquipment">IT Equipment</option>
                            <option value="ITSoftware">IT Software</option>
                            <option value="OfficeSupplies">Office Supplies</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Travel">Travel</option>
                            <option value="ProfServices">Professional Services</option>
                            <option value="Training">Training & Development</option>
                            <option value="Marketing">Marketing Materials</option>
                            <option value="Other">Other</option>
                        </select>
                        <div class="invalid-feedback">Please select a product category</div>
                    </div>
                </div>
                  <div class="row mb-4">
                    <div class="col-md-12">
                        <label for="productDescription" class="form-label required-field">Product/Service Description</label>
                        <textarea class="form-control" id="productDescription" name="productDescription" rows="4" required></textarea>
                        <div class="invalid-feedback">Please provide a product or service description</div>
                    </div>
                </div>
                
                <!-- Product Information Image Upload - Main Highlight -->
                <div class="row mb-5">
                    <div class="col-md-12">
                        <div class="card border-primary">                            <div class="card-header bg-primary text-white text-center">
                                <h5 class="mb-0">
                                    <i class="fas fa-images me-2"></i>Product Information Images
                                </h5>
                                <small>Upload images containing all product details and specifications</small>
                            </div><div class="card-body text-center">
                                <div class="mb-3">
                                    <label for="productImages" class="form-label fw-bold">Product Details Images</label>
                                    <div class="file-upload-container">
                                        <div class="custom-file-upload">
                                            <input class="form-control form-control-lg" type="file" id="productImages" name="productImages[]" 
                                                accept="image/*" multiple required>
                                            <div class="file-upload-info mt-2">
                                                <div class="selected-file-count text-primary mb-1">No files selected</div>
                                                <div class="file-drop-message">
                                                    <i class="fas fa-cloud-upload-alt me-2"></i>Click to select or drop images here
                                                </div>
                                            </div>
                                            <div class="form-text">Upload images that contain product information, specifications, and details (multiple files supported)</div>
                                        </div>
                                        <div class="invalid-feedback">Please upload at least one product information image</div>
                                    </div>
                                </div>
                                
                                <!-- Image Carousel Preview Area -->
                                <div id="imagePreviewContainer" class="mt-4" style="display: none;">
                                    <div class="border rounded p-3 bg-light">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="text-primary mb-0">
                                                <i class="fas fa-eye me-2"></i>Product Information Preview (<span id="imageCount">0</span> images)
                                            </h6>
                                            <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeAllImages()">
                                                <i class="fas fa-trash me-1"></i>Remove All Images
                                            </button>
                                        </div>
                                        
                                        <!-- Bootstrap Carousel -->
                                        <div id="productImageCarousel" class="carousel slide" data-bs-ride="false">
                                            <div class="carousel-inner" id="carouselInner">
                                                <!-- Carousel slides will be dynamically generated here -->
                                            </div>
                                            
                                            <!-- Carousel Controls -->
                                            <button class="carousel-control-prev" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev" style="display: none;">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next" style="display: none;">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                            
                                            <!-- Carousel Indicators -->
                                            <div class="carousel-indicators" id="carouselIndicators" style="display: none;">
                                                <!-- Indicators will be dynamically generated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label for="totalAmount" class="form-label required-field">Total Amount (Estimated)</label>
                        <div class="input-group">
                            <select class="form-select" id="currency" name="currency" style="max-width: 100px;">
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="VND">VND</option>
                                <option value="JPY">JPY</option>
                            </select>
                            <input type="number" class="form-control" id="totalAmount" name="totalAmount" min="0" step="0.01" required>
                        </div>
                        <div class="invalid-feedback">Please enter the total estimated amount</div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-12">
                        <label for="justification" class="form-label required-field">Reason</label>
                        <textarea class="form-control" id="justification" name="justification" rows="3" 
                                  placeholder="What is that product used for? Which department, individual, how many times?" required></textarea>
                        <div class="invalid-feedback">Please provide a reason for this request</div>
                    </div>
                </div>
                
                <!-- Payment Option -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <label class="form-label required-field">Payment Option</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="paymentOption" id="companyPay" value="company" required>
                            <label class="form-check-label" for="companyPay">
                                Company Pay
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="paymentOption" id="customerPay" value="customer" required>
                            <label class="form-check-label" for="customerPay">
                                Customer Pay
                            </label>
                        </div>
                        <div class="invalid-feedback">Please select a payment option</div>
                    </div>
                </div>
                  
                <!-- Company Representative Search (shows when Company Pay is selected) -->
                <div class="row mb-4" id="companyRepSection" style="display: none;">
                    <div class="col-md-12">
                        <label for="companyRep" class="form-label required-field">Company Representative</label>
                        <div class="position-relative">
                            <input type="text" class="form-control" id="companyRep" name="companyRep" 
                                   placeholder="Search and select company representative..." 
                                   autocomplete="off">
                            <div class="invalid-feedback">Please select a company representative</div>
                            
                            <!-- Company Rep Search Results Dropdown -->
                            <div class="dropdown-menu w-100" id="companyRepDropdown" style="display: none;">
                                <div class="dropdown-item" data-value="john.doe">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">JD</div>
                                        <div>
                                            <div class="fw-bold">John Doe</div>
                                            <small class="text-muted">Finance Manager</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="dropdown-item" data-value="jane.smith">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">JS</div>
                                        <div>
                                            <div class="fw-bold">Jane Smith</div>
                                            <small class="text-muted">Operations Director</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Customer Information Form (shows when Customer Pay is selected) -->
                <div id="customerInfoSection" style="display: none;">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="customerName" class="form-label required-field">Customer Name</label>
                            <input type="text" class="form-control" id="customerName" name="customerName">
                            <div class="invalid-feedback">Please enter customer name</div>
                        </div>
                        <div class="col-md-6">
                            <label for="customerEmail" class="form-label required-field">Customer Email</label>
                            <input type="email" class="form-control" id="customerEmail" name="customerEmail">
                            <div class="invalid-feedback">Please enter customer email</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="customerPhone" class="form-label">Customer Phone</label>
                            <input type="tel" class="form-control" id="customerPhone" name="customerPhone">
                        </div>
                        <div class="col-md-6">
                            <label for="customerCompany" class="form-label">Customer Company</label>
                            <input type="text" class="form-control" id="customerCompany" name="customerCompany">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <label for="customerAddress" class="form-label">Customer Address</label>
                            <textarea class="form-control" id="customerAddress" name="customerAddress" rows="2"></textarea>
                        </div>
                    </div>                </div>

                <div class="row mb-4">
                    <div class="col-md-12">
                        <label for="deliveryDate" class="form-label">Delivery Date (Desired)</label>
                        <input type="text" class="form-control date-picker" id="deliveryDate" name="deliveryDate">
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-12">
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                    </div>
                </div>
            </form>
            
            <!-- Success Alert -->
            <div id="success-alert" class="alert alert-success" role="alert">
                <h4 class="alert-heading">Request Submitted Successfully!</h4>
                <p>Your purchase request has been submitted to the approval workflow. You can track the status of your request in the dashboard.</p>
                <hr>
                <p class="mb-0">Request ID: <span id="requestId"></span></p>
            </div>
            
            <!-- Error Alert -->
            <div id="error-alert" class="alert alert-danger" role="alert">
                <h4 class="alert-heading">Error!</h4>
                <p>There was a problem with your submission. Please try again.</p>
                <hr>
                <p class="mb-0" id="error-message"></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date pickers
            flatpickr('.date-picker', {
                dateFormat: 'Y-m-d',
                allowInput: true
            });
            
            // Set current date
            const today = new Date();
            const formattedDate = today.getFullYear() + '-' + 
                                String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                String(today.getDate()).padStart(2, '0');
            
            document.getElementById('dateRequested').value = formattedDate;
            document.getElementById('creationDate').value = formattedDate;
            
            // Mock user data (in a real system, this would come from the authentication system)
            document.getElementById('requesterName').value = 'John Doe';
              // Multiple images upload and carousel preview functionality
            let selectedImages = [];
            const fileUpload = document.getElementById('productImages');
            const fileDropArea = document.querySelector('.custom-file-upload');
            const fileCountElement = document.querySelector('.selected-file-count');
            
            // Update file count display
            function updateFileCountDisplay() {
                if (selectedImages.length === 0) {
                    fileCountElement.textContent = 'No files selected';
                    fileCountElement.classList.remove('text-success');
                } else {
                    fileCountElement.textContent = selectedImages.length === 1 
                        ? '1 file selected' 
                        : `${selectedImages.length} files selected`;
                    fileCountElement.classList.add('text-success');
                }
            }
            
            // Add drag and drop functionality
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                fileDropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                fileDropArea.classList.remove('dragover');
            }
            
            fileDropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                fileUpload.files = files;
                handleFileSelect(files);
            }
            
            // Handle file selection
            function handleFileSelect(files) {
                if (files.length === 0) {
                    hideImagePreview();
                    updateFileCountDisplay();
                    return;
                }
                
                // Clear previous images
                selectedImages = [];
                
                // Validate and process each file
                let validFiles = [];
                for (let file of files) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        alert(`File "${file.name}" is not an image. Please select only image files.`);
                        continue;
                    }
                    
                    // Validate file size (max 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert(`File "${file.name}" is too large. Maximum file size is 10MB.`);
                        continue;
                    }
                    
                    validFiles.push(file);
                }
                
                if (validFiles.length === 0) {
                    hideImagePreview();
                    updateFileCountDisplay();
                    return;
                }
                
                // Process valid files
                let processedCount = 0;
                validFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        selectedImages.push({
                            file: file,
                            dataUrl: e.target.result,
                            name: file.name
                        });
                        
                        processedCount++;
                        if (processedCount === validFiles.length) {
                            updateFileCountDisplay();
                            createImageCarousel();
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            fileUpload.addEventListener('change', function(e) {
                handleFileSelect(Array.from(e.target.files));
            });
            
            // Global variables for image handling
            window.selectedImages = selectedImages;
            
            // Ensure functions are available globally
            window.removeImageFromCarousel = function(index) {
                if (index < 0 || index >= selectedImages.length) return;
                
                // Remove image from array
                selectedImages.splice(index, 1);
                
                // Recreate carousel or hide if no images left
                if (selectedImages.length === 0) {
                    hideImagePreview();
                    // Clear file input
                    document.getElementById('productImages').value = '';
                } else {
                    createImageCarousel();
                }
                
                // Update file count display
                updateFileCountDisplay();
            };
            
            window.removeAllImages = function() {
                selectedImages = [];
                hideImagePreview();
                document.getElementById('productImages').value = '';
                updateFileCountDisplay();
            };
            
            function hideImagePreview() {
                const container = document.getElementById('imagePreviewContainer');
                if (container) {
                    container.style.display = 'none';
                }
                selectedImages = [];
            }
            
            function createImageCarousel() {
                try {
                    if (selectedImages.length === 0) {
                        hideImagePreview();
                        return;
                    }
                    
                    const carouselInner = document.getElementById('carouselInner');
                    const carouselIndicators = document.getElementById('carouselIndicators');
                    const imageCount = document.getElementById('imageCount');
                    const prevButton = document.querySelector('.carousel-control-prev');
                    const nextButton = document.querySelector('.carousel-control-next');
                    
                    if (!carouselInner || !carouselIndicators || !imageCount) {
                        console.error('Required carousel elements not found');
                        return;
                    }
                    
                    // Clear existing content
                    carouselInner.innerHTML = '';
                    carouselIndicators.innerHTML = '';
                    
                    // Create carousel slides
                    selectedImages.forEach((image, index) => {
                        // Create slide
                        const slide = document.createElement('div');
                        slide.className = `carousel-item${index === 0 ? ' active' : ''}`;
                        slide.innerHTML = `
                            <div class="text-center">
                                <img src="${image.dataUrl}" class="d-block mx-auto img-fluid" 
                                     alt="${image.name}" 
                                     style="max-height: 500px; max-width: 100%; object-fit: contain;">
                                <div class="mt-2">
                                    <small class="text-muted">${image.name}</small>
                                    <button type="button" class="btn btn-outline-danger btn-sm ms-2" 
                                            onclick="removeImageFromCarousel(${index})">
                                        <i class="fas fa-times me-1"></i>Remove
                                    </button>
                                </div>
                            </div>
                        `;
                        carouselInner.appendChild(slide);
                        
                        // Create indicator
                        const indicator = document.createElement('button');
                        indicator.type = 'button';
                        indicator.setAttribute('data-bs-target', '#productImageCarousel');
                        indicator.setAttribute('data-bs-slide-to', index.toString());
                        if (index === 0) indicator.classList.add('active');
                        indicator.setAttribute('aria-label', `Slide ${index + 1}`);
                        carouselIndicators.appendChild(indicator);
                    });
                    
                    // Update image count
                    imageCount.textContent = selectedImages.length;
                    
                    // Show/hide controls based on number of images
                    if (selectedImages.length > 1) {
                        if (prevButton) prevButton.style.display = 'flex';
                        if (nextButton) nextButton.style.display = 'flex';
                        carouselIndicators.style.display = 'flex';
                    } else {
                        if (prevButton) prevButton.style.display = 'none';
                        if (nextButton) nextButton.style.display = 'none';
                        carouselIndicators.style.display = 'none';
                    }
                    
                    // Show preview container
                    document.getElementById('imagePreviewContainer').style.display = 'block';
                } catch (error) {
                    console.error('Error creating image carousel:', error);
                    alert('Error creating image preview. Please try again.');
                }
            }
            
            // Payment option toggle functionality
            const companyPayRadio = document.getElementById('companyPay');
            const customerPayRadio = document.getElementById('customerPay');
            const companyRepSection = document.getElementById('companyRepSection');
            const customerInfoSection = document.getElementById('customerInfoSection');
            
            companyPayRadio.addEventListener('change', function() {
                if (this.checked) {
                    companyRepSection.style.display = 'block';
                    customerInfoSection.style.display = 'none';
                    // Make company rep required
                    document.getElementById('companyRep').required = true;
                    // Remove customer fields from required
                    document.getElementById('customerName').required = false;
                    document.getElementById('customerEmail').required = false;
                }
            });
            
            customerPayRadio.addEventListener('change', function() {
                if (this.checked) {
                    companyRepSection.style.display = 'none';
                    customerInfoSection.style.display = 'block';
                    // Make customer fields required
                    document.getElementById('customerName').required = true;
                    document.getElementById('customerEmail').required = true;
                    // Remove company rep from required
                    document.getElementById('companyRep').required = false;
                }
            });
            
            // Company Representative Search Functionality
            const companyRepInput = document.getElementById('companyRep');
            const companyRepDropdown = document.getElementById('companyRepDropdown');
            
            companyRepInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                if (searchTerm.length >= 2) {
                    companyRepDropdown.style.display = 'block';
                } else {
                    companyRepDropdown.style.display = 'none';
                }
            });
            
            // Handle company rep selection
            companyRepDropdown.addEventListener('click', function(e) {
                if (e.target.closest('.dropdown-item')) {
                    e.preventDefault();
                    const selectedItem = e.target.closest('.dropdown-item');
                    const selectedText = selectedItem.querySelector('.fw-bold').textContent;
                    companyRepInput.value = selectedText;
                    companyRepDropdown.style.display = 'none';
                }
            });
            
            // Hide dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!companyRepInput.contains(e.target) && !companyRepDropdown.contains(e.target)) {
                    companyRepDropdown.style.display = 'none';
                }
            });              // Set default values for demo
            document.getElementById('requestTitle').value = 'New Laptop Request';
            document.getElementById('department').value = 'IT';
            document.getElementById('productCategory').value = 'ITEquipment';
            document.getElementById('totalAmount').value = 1500;
            document.getElementById('justification').value = 'Upgrade for better performance';
            document.getElementById('customerName').value = 'Acme Corp';
            document.getElementById('customerEmail').value = 'contact@acmecorp.com';
            document.getElementById('customerPhone').value = '123-456-7890';
            document.getElementById('customerCompany').value = 'Acme Corp';
            document.getElementById('customerAddress').value = '123 Acme St, Metropolis';
            
            // Form validation
            function validateForm() {
                const form = document.getElementById('purchaseRequestForm');
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        field.classList.remove('is-invalid');
                    }
                });
                  return isValid;
            }
            
            // Form submission
            document.getElementById('purchaseRequestForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (validateForm()) {
                    // Set status to submitted
                    document.getElementById('requestStatus').value = 'Submitted';
                    
                    // Show success message
                    document.getElementById('successMessage').innerHTML = 
                        `Purchase request REQ-2025-0542 has been submitted successfully.<br>
                        <div class="mt-3">
                            <button type="button" class="btn btn-primary btn-sm me-2" onclick="location.href='request_list.html'">
                                <i class="fas fa-list me-1"></i>View Request List
                            </button>
                        </div>`;
                    document.getElementById('success-alert').style.display = 'block';
                }
            });
        });
    </script>

    <script>
        // Handle nested dropdowns in sidebar
        document.addEventListener('DOMContentLoaded', function() {
            // Setup for submenus
            const subMenuToggleButtons = document.querySelectorAll('.dropdown-item.dropdown-toggle');
            
            subMenuToggleButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Find the nearest submenu to this toggle button
                    const submenu = this.nextElementSibling;
                    
                    // Toggle the show class on this submenu
                    submenu.classList.toggle('show');
                    
                    // Close other submenus at the same level
                    const siblings = Array.from(this.parentElement.parentElement.children)
                        .filter(child => child !== this.parentElement)
                        .map(child => child.querySelector('.dropdown-submenu'))
                        .filter(Boolean);
                    
                    siblings.forEach(sibling => {
                        sibling.classList.remove('show');
                    });
                });
            });
            
            // Close submenus when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dropdown-submenu') && !e.target.classList.contains('dropdown-toggle')) {
                    document.querySelectorAll('.dropdown-submenu.show').forEach(menu => {
                        menu.classList.remove('show');
                    });
                }
            });
        });
    </script>    <script>
        // Function to remove uploaded image (legacy function, now redirects to removeAllImages)
        function removeImage() {
            removeAllImages();
        }
    </script>
    <script>
        // Click to enlarge image functionality for carousel images
        document.addEventListener('click', function(e) {
            if (e.target.matches('.carousel-item img')) {
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Product Information - Full View</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-center">
                                <img src="${e.target.src}" class="img-fluid" alt="${e.target.alt}">
                                <div class="mt-2">
                                    <small class="text-muted">${e.target.alt}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                // Remove modal from DOM when hidden
                modal.addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }
        });
    </script>
</body>
</html>

